{% extends "base.html" %}
{% block title %}Shop Client{% endblock %}
{% block content %}
<section class="space-y-6">
    <div class="space-y-2">
        <h1 class="text-3xl font-bold text-slate-900">Shop Client</h1>
        <p class="text-slate-600">Sending requests to <span class="font-mono">{{ api_base }}</span></p>
    </div>

    {% if message %}
    <div class="rounded-md bg-emerald-50 border border-emerald-200 text-emerald-900 px-4 py-3">
        {{ message }}
    </div>
    {% endif %}

    {% if errors %}
    <div class="space-y-2">
        {% for err in errors %}
        <div class="rounded-md bg-rose-50 border border-rose-200 text-rose-900 px-4 py-3">
            {{ err }}
        </div>
        {% endfor %}
    </div>
    {% endif %}

    <div class="grid gap-6 md:grid-cols-2">
        <form method="post" action="{{ url_for('create_item') }}" class="rounded-lg bg-white shadow-sm border border-slate-200 p-6 space-y-4">
            <h2 class="text-xl font-semibold text-slate-800">Create Item</h2>
            <div class="space-y-1">
                <label for="item-name" class="block text-sm font-medium text-slate-600">Name</label>
                <input id="item-name" name="name" type="text" required class="w-full rounded-md border border-slate-300 px-3 py-2 focus:border-sky-500 focus:ring focus:ring-sky-200" placeholder="Example item">
            </div>
            <div class="space-y-1">
                <label for="item-price" class="block text-sm font-medium text-slate-600">Price</label>
                <input id="item-price" name="price" type="number" step="0.01" min="0" required class="w-full rounded-md border border-slate-300 px-3 py-2 focus:border-sky-500 focus:ring focus:ring-sky-200" placeholder="9.99">
            </div>
            <button type="submit" class="inline-flex items-center justify-center rounded-md bg-blue-600 px-4 py-2 text-white font-medium shadow-sm hover:bg-blue-700">Create</button>
        </form>

        <form method="post" action="{{ url_for('create_cart') }}" class="rounded-lg bg-white shadow-sm border border-slate-200 p-6 space-y-4">
            <h2 class="text-xl font-semibold text-slate-800">Create Cart</h2>
            <p class="text-sm text-slate-600">Create an empty cart and add items below.</p>
            <button type="submit" class="inline-flex items-center justify-center rounded-md bg-indigo-600 px-4 py-2 text-white font-medium shadow-sm hover:bg-indigo-700">Create Cart</button>
        </form>
    </div>

    <section class="rounded-lg bg-white shadow-sm border border-slate-200 p-6">
        <h2 class="text-xl font-semibold text-slate-800 mb-4">Items</h2>
        {% if items %}
        <div class="overflow-x-auto">
            <table class="min-w-full divide-y divide-slate-200">
                <thead class="bg-slate-50">
                    <tr>
                        <th class="px-4 py-2 text-left text-xs font-semibold uppercase tracking-wide text-slate-500">ID</th>
                        <th class="px-4 py-2 text-left text-xs font-semibold uppercase tracking-wide text-slate-500">Name</th>
                        <th class="px-4 py-2 text-left text-xs font-semibold uppercase tracking-wide text-slate-500">Price</th>
                        <th class="px-4 py-2 text-left text-xs font-semibold uppercase tracking-wide text-slate-500">Deleted</th>
                        <th class="px-4 py-2 text-left text-xs font-semibold uppercase tracking-wide text-slate-500">Actions</th>
                    </tr>
                </thead>
                <tbody class="divide-y divide-slate-100">
                    {% for item in items %}
                    <tr>
                        <td class="px-4 py-2 font-mono text-sm text-slate-700">{{ item["id"] }}</td>
                        <td class="px-4 py-2 text-sm text-slate-800">{{ item["name"] }}</td>
                        <td class="px-4 py-2 text-sm text-slate-800">{{ '%.2f' | format(item["price"]) }}</td>
                        <td class="px-4 py-2 text-sm text-slate-500">{{ item["deleted"] }}</td>
                        <td class="px-4 py-2 text-sm text-slate-800">
                            {% if not item["deleted"] %}
                            <form method="post" action="{{ url_for('delete_item', item_id=item['id']) }}">
                                <button type="submit" class="inline-flex items-center justify-center rounded-md bg-red-600 px-3 py-1 text-white shadow-sm hover:bg-red-700">Delete</button>
                            </form>
                            {% else %}
                            <span class="text-xs text-slate-400 italic">Deleted</span>
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <p class="text-sm text-slate-500">No items created yet.</p>
        {% endif %}
    </section>

    <section class="rounded-lg bg-white shadow-sm border border-slate-200 p-6 space-y-4">
        <h2 class="text-xl font-semibold text-slate-800">Carts</h2>
        {% if carts %}
        <div class="space-y-4">
            {% for cart in carts %}
            <div class="rounded-md border border-slate-200 p-4 space-y-3">
                <div class="flex items-center justify-between">
                    <h3 class="text-lg font-semibold text-slate-800">Cart #{{ cart["id"] }}</h3>
                    <span class="text-sm text-slate-500">Total: {{ '%.2f' | format(cart["price"]) }}</span>
                </div>
                <div class="space-y-2">
                    <h4 class="text-sm font-medium text-slate-600">Items ({{ cart["items"] | length }})</h4>
                    {% if cart["items"] %}
                    <ul class="space-y-1 text-sm text-slate-700">
                        {% for cart_item in cart["items"] %}
                        <li class="flex items-center justify-between">
                            <span>{{ cart_item["name"] }}</span>
                            <span class="font-mono">x{{ cart_item["quantity"] }}</span>
                            <span class="text-xs text-slate-500">{{ 'Available' if cart_item["available"] else 'Unavailable' }}</span>
                        </li>
                        {% endfor %}
                    </ul>
                    {% else %}
                    <p class="text-sm text-slate-500">Cart is empty.</p>
                    {% endif %}
                </div>
                {% if items %}
                <form method="post" action="{{ url_for('add_item_to_cart', cart_id=cart['id']) }}" class="flex flex-col gap-2 md:flex-row md:items-center">
                    <label for="cart-{{ cart['id'] }}-item" class="text-sm font-medium text-slate-600">Add item</label>
                    <select id="cart-{{ cart['id'] }}-item" name="item_id" class="flex-1 rounded-md border border-slate-300 px-3 py-2 focus:border-indigo-500 focus:ring focus:ring-indigo-200" required>
                        <option value="" disabled selected>Select item</option>
                        {% for item in items %}
                        <option value="{{ item['id'] }}">#{{ item['id'] }} â€” {{ item['name'] }}</option>
                        {% endfor %}
                    </select>
                    <button type="submit" class="inline-flex items-center justify-center rounded-md bg-green-600 px-4 py-2 text-white font-medium shadow-sm hover:bg-green-700">Add</button>
                </form>
                {% else %}
                <p class="text-sm text-slate-500">Create items to add them to this cart.</p>
                {% endif %}
            </div>
            {% endfor %}
        </div>
        {% else %}
        <p class="text-sm text-slate-500">No carts created yet.</p>
        {% endif %}
    </section>
</section>
{% endblock %}
